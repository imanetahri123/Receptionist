<div class="record-container">
  <!-- Header -->
  <section class="record-header glass-card">
    <div class="header-content">
      <h2>Gestion des Dossiers Médicaux</h2>
      <p>Suivez les informations des patients en temps réel.</p>
    </div>

    <div class="header-actions">
      <button class="btn-primary">+ Nouveau Patient</button>

      <!-- Toggle View -->
      <div class="view-toggle">
        <span [class.active]="currentView === 'grid'">Grille</span>
        <label class="switch">
          <input type="checkbox" [(ngModel)]="isListView" (change)="toggleView()" />
          <span class="slider"></span>
        </label>
        <span [class.active]="currentView === 'list'">Liste</span>
      </div>
    </div>
  </section>

  <!-- Section de filtre -->
  <section class="filter-section">
    <div class="filter-row">
      <!-- Barre de recherche -->
      <div class="filter-group">
        <label>Rechercher</label>
        <input type="text" placeholder="Nom, ID..." [(ngModel)]="searchQuery" (input)="applyFilters()" />
      </div>

      <!-- Filtre par statut -->
      <div class="filter-group">
        <label>Statut</label>
        <select [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="">Tous les statuts</option>
          <option value="active">Active</option>
          <option value="follow up">Follow up</option>
          <option value="critical">Critical</option>
        </select>
      </div>

      <!-- Filtre par dernière visite -->
      <div class="filter-group">
        <label>Dernière visite</label>
        <select [(ngModel)]="selectedVisitFilter" (change)="applyFilters()">
          <option value="">Toutes les dates</option>
          <option value="today">Aujourd’hui</option>
          <option value="yesterday">Hier</option>
          <option value="week">Cette semaine</option>
          <option value="older">Plus ancien</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Vue Grille -->
  <div *ngIf="currentView === 'grid'" class="patients-section">
    <div class="patient-grid">
      <div class="patient-card glass-card" *ngFor="let patient of filteredPatients">
        <div class="patient-header">
          <img [src]="patient.photo" [alt]="'Photo de ' + patient.name" class="avatar" (error)="onImageError($event)" />
          <div class="info">
            <h3>{{ patient.name }}</h3>
            <p>{{ patient.email }}</p>
          </div>
        </div>

        <div class="patient-details">
          <p><strong>ID :</strong> #{{ patient.id }}</p>
          <p><strong>Téléphone :</strong> {{ patient.phone || 'Non renseigné' }}</p>
          <p><strong>Date de naissance :</strong> {{ patient.dob || 'Non renseignée' }}</p>
        </div>

        <div class="actions">
          <button class="btn-action btn-edit" title="Modifier"><i class="fas fa-pencil-alt"></i></button>
          <button class="btn-action btn-delete" title="Supprimer"><i class="fas fa-trash-alt"></i></button>
          <button class="btn-action btn-view" title="Voir le dossier"><i class="fas fa-eye"></i></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Vue Liste (Tableau) -->
  <div *ngIf="currentView === 'list'" class="patients-section">
    <div class="patient-list">
      <table class="patient-table">
        <thead>
          <tr>
            <th>#ID</th>
            <th>Nom du Patient</th>
            <th>Dernière visite</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let patient of filteredPatients">
            <td>#{{ patient.id }}</td>
            <td>
              <div class="table-patient-info">
                <img [src]="patient.photo" alt="Photo" class="table-avatar" (error)="onImageError($event)" />
                <span>{{ patient.name }}</span>
              </div>
            </td>
            <td>{{ getLastVisitDate(patient.dob) }}</td>
            <td>
              <span class="status-badge" [class]="getStatusClass(patient.status)">
                {{ patient.status }}
              </span>
            </td>
            <td>
              <button class="btn-action btn-edit" title="Modifier"><i class="fas fa-pencil-alt"></i></button>
              <button class="btn-action btn-delete" title="Supprimer"><i class="fas fa-trash-alt"></i></button>
              <button class="btn-action btn-view" title="Voir le dossier"><i class="fas fa-eye"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>